# Тестовые сценарии для JuicyPoint MVP (Бонусная система)

## 1. Валидация списания (Безопасность)
**Цель:** Убедиться, что сервер отклоняет заказы, где `bonuses_used` превышает реальный `bonus_balance` клиента.
*   **Входные данные:** Баланс клиента: 50. Заказ: списать 100 бонусов.
*   **Ожидаемый результат:** Ошибка `Ошибка: Недостаточно бонусов для списания`. Заказ не создан.
*   **Статус:** ✅ (Проверяется в симуляции)

## 2. Успешное списание
**Цель:** Убедиться, что при достаточном балансе заказ проходит.
*   **Входные данные:** Баланс клиента: 200. Заказ: списать 100 бонусов.
*   **Ожидаемый результат:** Успех. Новый баланс клиента: 100. Транзакция списания записана.

## 3. Начисление Кэшбэка
**Цель:** Проверить формулу начисления (1%).
*   **Входные данные:** Сумма заказа 5000р.
*   **Ожидаемый результат:** Начисление +50 бонусов.

## 4. Реферальная система (Приглашение)
**Цель:** Проверить начисление пригласившему другу.
*   **Входные данные:** Пользователь А пригласил Б. Б делает заказ на 2000р.
*   **Ожидаемый результат:** Пользователь А получает бонус (формула: `total / 1000 * 5` = 10 бонусов).

## 5. Защита от взлома "Новичка"
**Цель:** Проверить, что старый клиент не может отправить флаг `new_user_discount`.
*   **Входные данные:** Клиент есть в базе (`isNewClient: false`), но в JSON заказа шлет `new_user_discount: 300`.
*   **Ожидаемый результат:** Скидка сбрасывается в 0. Цена пересчитывается. Админ получает алерт.
