<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juicy Puff | –ì–ª–∞–≤–Ω–æ–µ –ú–µ–Ω—é</title>
    <link rel="stylesheet" href="css/style.css?v=V_LATEST">
    <link rel="stylesheet" href="css/css_chunk_responsive.css?v=V_LATEST">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        (function () {
            const tg = window.Telegram?.WebApp;
            if (tg) {
                tg.expand();
                try {
                    tg.setHeaderColor('#050510');
                    tg.setBackgroundColor('#050510');
                    if (tg.requestFullscreen) {
                        tg.requestFullscreen();
                    }
                    tg.ready();
                } catch (e) {
                    console.log("TG Styling Error:", e);
                }
            }
        })();
    </script>
</head>

<body>

    <div class="container">

        <img src="img/logo_cyber.png" alt="Juicy Puff Cyber Logo" class="main-logo">



        <div class="menu-buttons">

            <a href="promo.html" class="menu-button promo-btn">
                <span class="icon-spacer">üî•</span> **–ê–∫—Ü–∏–∏ –∏ –ù–æ–≤–∏–Ω–∫–∏**
            </a>

            <a href="catalogue.html" class="menu-button catalogue-btn">
                <img src="img/vape-icon.svg" alt="–í–µ–π–ø" class="button-icon catalogue-icon">
                –ö–∞—Ç–∞–ª–æ–≥ (–û–¥–Ω–æ—Ä–∞–∑–∫–∏)
            </a>

            <a href="cart.html" class="menu-button cart-btn">
                <span class="icon-spacer">üõí</span> –ö–æ—Ä–∑–∏–Ω–∞
            </a>

            <a href="profile.html" class="menu-button orders-btn">
                <span class="icon-spacer">üë§</span> –ü—Ä–æ—Ñ–∏–ª—å
            </a>



            <a href="info.html" class="menu-button info-btn">
                <span class="icon-spacer">üìö</span> –í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
            </a>

        </div>
    </div>

    <div id="coming-soon-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeComingSoon()">&times;</span>
            <h2>–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ üõ†Ô∏è</h2>
            <p>–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª —Å–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è! –°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏.</p>
            <button onclick="closeComingSoon()">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <script type="module">
        import { fetchProducts, fetchClientData } from './js/services/api.js?v=V_LATEST';
        import { getUserId } from './js/services/user-id.js';
        import { showComingSoon, closeComingSoon } from './js/utils/ui.js';
        import { initReferralSystem } from './js/services/referral-handler.js';

        // Expose for HTML onclick handlers
        window.showComingSoon = showComingSoon;
        window.closeComingSoon = closeComingSoon;

        // Initialize referral tracking
        initReferralSystem();

        async function preloadCatalog() {
            try {
                const products = await fetchProducts();
                if (Array.isArray(products)) {
                    sessionStorage.setItem('preload_catalog', JSON.stringify(products));
                    console.log("Menu: –ö–∞—Ç–∞–ª–æ–≥ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω.");
                }
            } catch (e) {
                console.log("Menu: –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å.");
            }
        }

        async function preloadUserData() {
            try {
                const userId = getUserId();
                console.log("Menu: –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...", userId);

                const data = await fetchClientData(userId);

                if (data && typeof data.bonus_balance !== 'undefined') {
                    // Save to cache immediately
                    localStorage.setItem('juicy_bonus_' + userId, data.bonus_balance);
                    console.log("Menu: –ë–æ–Ω—É—Å—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤ –∫—ç—à–µ:", data.bonus_balance);
                }
            } catch (e) {
                console.log("Menu: –û—à–∏–±–∫–∞ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:", e);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            preloadCatalog();
            preloadUserData();
        });

    </script>

</body>

</html>